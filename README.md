# Cassandra Snapshot Tools 

A handy couple of scripts that make creating, moving, and restoring SSTable snapshots between clusters easy.  Some common use cases include:
* Copying keyspaces between clusters (QA environments, for example)
* Staging an upgrade (application, Cassandra, both) using a copy of live data
* Seeding data in a test environment
* Snapshotting a keyspace for offline analytics
* Backup and restore
* Generally moving a keyspace from one Cassandra cluster to another

Cassandra Snapshot Tools currently includes two BASH shell scripts, `localDataBackup.sh` and `localDataRestore.sh`, which leverage standard Cassandra utilities like `nodetool`, `cqlsh` to simplify the process of creating snapshots and moving them between hosts.  A convenient compressed tar archive is generated by `localDataBackup.sh`, and includes all of the SSTable snapshot files, metadata, and schema information necessary to restore the keyspace into another Cassandra cluster (or the same cluster).  The `localDataRestore.sh` tool is then used to restore data into an empty Cassandra node with the given table structure.

### Features
* Automatically generates a keyspace snapshot and packages into an easy-to-move archive
* Copies snapshots out of the Cassandra data directory, space is reclaimed using `nodetool clearsnapshot`
* Schedulable using Cron (e.g. for scheduled backups)
* Easy to use with sane defaults
* Tested on Cassandra 3.11

### Usage
#### localDataBackup.sh

    Usage: ./localDataBackup.sh -h
           ./localDataBackup.sh -k <keyspace name> [-s <snapshot name>] [-y <cassandra.yaml file>] [--no-timestamp]
        -h,--help                          Print usage and exit
        -v,--version                       Print version information and exit
        -k,--keyspace <keyspace name>      REQUIRED: The name of the keyspace to snapshot
        -s,--snapshot <snapshot name>      REQUIRED: The name of an existing snapshot to package
        -y,--yaml <cassandra.yaml file>    Alternate cassandra.yaml file

#### putSnapshot

    Usage : 
        ./localDataRestore.sh SNAPSHOT_TAR KEYSPACE
            KEYSPACE: the keyspace where to restore all data
            SNAPSHOT_TAR: the snapshot tarball to restore data from


### Basic Examples

1. Backup, clear then restore:

    ```sh
    $ ./localDataBackup.sh -k <keyspace name> -s <snapshot name>
    $ ./truncateAll.sh <keyspace name> 
    $ ./localDataRestore.sh <snapshot package file> <new keyspace name>
    ```

### Caveats
* Currently supports snapshots/restores between clusters running similar versions of Cassandra.
* Local access to the source Cassandra node is required (to create/collect snapshot files).  Fairly open network access is required to the destination Cassandra node (to create the schema and load SSTables).

### Contributing
All contributions welcome!  Please see [How to Contribute](CONTRIBUTING.md).

### Credit

This work is copied from https://github.com/AppliedInfrastructure/cassandra-snapshot-tools
